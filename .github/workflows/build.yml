name: Build Releases

on: push

jobs:
  build-job:
    permissions: write-all
    runs-on: macos-14
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: 18.x

      - name: Install Brew
        run: /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

      - name: Install Wine
        run: brew install --cask xquartz && brew install --cask wine-stable

      - name: Install node-prune
        run: curl -sf https://gobinaries.com/tj/node-prune | sh

      - run: npm install

      - run: npm run compile_css

      - run: sudo node .github/workflows/build_distributables.js

      - name: Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: |
            ./out/*
